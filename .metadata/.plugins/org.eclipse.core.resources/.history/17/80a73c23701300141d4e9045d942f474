/*
 * Michael Wielgosz
 * Mobile Interfaces & Usability
 * Term 1407
 * Informational App
 */

// Global variables
var bgColor = "#202020",
	bgImage = "background.png",
    pWidth = Ti.Platform.displayCaps.getPlatformWidth(),
    layoutMarginSmall = 4,
    layoutMargin = 8,
    imagesPerRow = 2,
    imageContainerWidth = pWidth - (layoutMargin * 2),
    thumbnailSize = (imageContainerWidth / imagesPerRow),
    loadJsonData = require("phoneData"),
	phoneDataJson = loadJsonData.phoneDataJson,
	tableDataJson = loadJsonData.tableDataJson;

// Main app window
var mainWindow = Ti.UI.createWindow({
	title : "Top Smartphones",
	backgroundColor : bgColor,
	backgroundImage : bgImage,
	backgroundRepeat : true
});

// NavigationWindow object for iOS
var navWindow = Ti.UI.iOS.createNavigationWindow({
	window : mainWindow
});

// Function for TableViewRow clicks
var displayPhoneSpecs = function(dataSource) {
	
	console.log("New Window phoneName: " + dataSource.imageLabel.text);

    // Window for description
    var answerWindow = Ti.UI.createWindow({
        backgroundColor: "#fff",
        backgroundImage: "background.png",
        backgroundRepeat: true,
        title: dataSource.imageLabel.text,
        layout: "vertical"
    });

    navWindow.openWindow(answerWindow);
};

// Function to dynamically open windows
var openSpecWindow = function() {
	
	console.log("New Window phoneName: " + this.phoneName);
	
    var specWindow = Ti.UI.createWindow({
        backgroundColor: bgColor,
        backgroundImage: bgImage,
        backgroundRepeat: true,
        title: this.phoneName,
        nav: navWindow
    });

    navWindow.openWindow(specWindow);
};

// Scroll view container for grid view
var phoneGridContainer = Ti.UI.createScrollView({
    top: layoutMargin,
    bottom: layoutMargin,
    left: layoutMargin,
    right: layoutMargin,
    layout: "horizontal",
    width: imageContainerWidth,
    contentWidth: imageContainerWidth,
    showVerticalScrollIndicator: true,
    borderRadius: layoutMargin,
    borderColor: "#000",
    borderWidth: 1,
    phoneName: "None"
});

// Add each thumbnail to the galleryContainer
for (var i in phoneDataJson) {
    var fileName = phoneDataJson[i].image,
    	phoneName = phoneDataJson[i].phone_name;
    	
    phoneGridContainer.phoneName = phoneName;
    
    // View to contain each image
    var imageWrapper = Ti.UI.createView({
        layout: "vertical",
        width: thumbnailSize,
        height: thumbnailSize,
        backgroundColor: "#5ac8fa",
        borderColor: "#000",
        borderWidth: 1,
        //phoneName: phoneName
    });
    
    // Image view to add image into container
    var image = Ti.UI.createImageView({
        image: fileName,
        top: layoutMarginSmall,
        height: thumbnailSize - (layoutMargin * 3)
    });
    
    var imageLabel = Ti.UI.createLabel({
    	text: phoneName,
    	font: {fontSize: 10},
    	color: "#000",
    	textAlign: "center",
    	top: layoutMarginSmall
    });
    
    //imageWrapper.addEventListener("click", openSpecWindow);

    imageWrapper.add(image);
    imageWrapper.add(imageLabel);

    phoneGridContainer.add(imageWrapper);
}

// Event listener for table
phoneGridContainer.addEventListener("click", function(clickEvent){
	openSpecWindow(clickEvent.source);
});

/*var specTableView = Ti.UI.createTableView({
	style : Ti.UI.iPhone.TableViewStyle.GROUPED,
});

// Nested loops for JSON data
for(var jLoop1 in tableDataJson){
	var specTableSection = Ti.UI.createTableViewSection({
		headerTitle: tableDataJson[jLoop1].title,
		hasDetail: true
	});
	console.log("Loop 1: " + tableDataJson[jLoop1].title);
	console.log("Elements: " + tableDataJson[jLoop1].elements);
	
	for(var jLoop2=0; jLoop2 < tableDataJson[jLoop1].length; jLoop2++){
		console.log("Loop 2: " + tableDataJson[jLoop1][jLoop2]);
		var specTableRow = Ti.UI.createTableViewRow({
            title: tableDataJson[jLoop1][jLoop2].title
        });
        
        specTableSection.add(secTableRow);
	}
	specTableView.appendSection(specTableSection);
}

//mainWindow.add(specTableView);*/
mainWindow.add(phoneGridContainer);

navWindow.open();
